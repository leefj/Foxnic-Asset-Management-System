-- Ops Auto Task File
-- File
delete from sys_file where id like 'T001_ops_f_%';
insert into sys_file(id,file_name,location,size,media_type,file_type)values('T001_ops_f_3','mysql-5.7.32-linux-glibc2.12-x86_64.tar.gz','/media/T001/mysql-5.7.32-linux-glibc2.12-x86_64.tar.gz',10000,'application/x-tar','gz');
insert into sys_file(id,file_name,location,size,media_type,file_type)values('T001_ops_f_4','redis-5.0.14.tar.gz','/media/T001/redis-5.0.14.tar.gz',10000,'application/x-tar','gz');
insert into sys_file(id,file_name,location,size,media_type,file_type)values('T001_ops_f_5','nginx-1.24.0.tar.gz','/media/T001/nginx-1.24.0.tar.gz',10000,'application/x-tar','gz');
insert into sys_file(id,file_name,location,size,media_type,file_type)values('T001_ops_f_6','apache-tomcat-9.0.80.tar.gz','/media/T001/apache-tomcat-9.0.80.tar.gz',10000,'application/x-tar','gz');
-- insert into sys_file(id,file_name,location,size,media_type,file_type)values('T001_ops_f_1','db2v11_db2ese_c.lic','/media/T001/db2v11_db2ese_c.lic',10000,'application/octet-stream','lic');
-- insert into sys_file(id,file_name,location,size,media_type,file_type)values('T001_ops_f_2','db2v11_tar.gz','/media/T001/db2v11_tar.gz',10000,'application/x-tar','gz');
-- Action File
delete from ops_auto_action_file where id like 'T001_ops_f_%';
insert into ops_auto_action_file(id,name,file_name,file_id,tenant_id)values('T001_ops_f_3','mysql-5.7.32-linux-glibc2.12-x86_64.tar.gz','mysql.tar.gz','T001_ops_f_3','T001');
insert into ops_auto_action_file(id,name,file_name,file_id,tenant_id)values('T001_ops_f_4','redis-5.0.14.tar.gz','redis.tar.gz','T001_ops_f_4','T001');
insert into ops_auto_action_file(id,name,file_name,file_id,tenant_id)values('T001_ops_f_5','nginx-1.24.0.tar.gz','nginx.tar.gz','T001_ops_f_5','T001');
insert into ops_auto_action_file(id,name,file_name,file_id,tenant_id)values('T001_ops_f_6','apache-tomcat-9.0.80.tar.gz','tomcat.tar.gz','T001_ops_f_6','T001');
-- insert into ops_auto_action_file(id,name,file_name,file_id,tenant_id)values('T001_ops_f_1','db2v11_db2ese_c.lic','db2v11_db2ese_c.lic','T001_ops_f_1','T001');
-- insert into ops_auto_action_file(id,name,file_name,file_id,tenant_id)values('T001_ops_f_2','db2v11_tar.gz','db2v11_tar.gz','T001_ops_f_2','T001');
-- Script
delete from sys_file where id like 'T001_ops_s_%';
insert into sys_file(id,file_name,location,size,media_type,file_type)values('T001_ops_s_1','deploy_tomcat.sh','/script/T001/deploy_tomcat.sh',10000,'text/x-sh','sh');
insert into sys_file(id,file_name,location,size,media_type,file_type)values('T001_ops_s_2','deploy_nginx.sh','/script/T001/deploy_nginx.sh',10000,'text/x-sh','sh');
insert into sys_file(id,file_name,location,size,media_type,file_type)values('T001_ops_s_3','deploy_mysql.sh','/script/T001/deploy_mysql.sh',10000,'text/x-sh','sh');
insert into sys_file(id,file_name,location,size,media_type,file_type)values('T001_ops_s_7','deploy_redis_single.sh','/script/T001/deploy_redis_single.sh',10000,'text/x-sh','sh');
-- insert into sys_file(id,file_name,location,size,media_type,file_type)values('T001_ops_s_4','deploy_db2.sh','/script/T001/deploy_db2.sh',10000,'text/x-sh','sh');
-- insert into sys_file(id,file_name,location,size,media_type,file_type)values('T001_ops_s_5','deploy_zabbix_agent.sh','/script/T001/deploy_zabbix_agent.sh',10000,'text/x-sh','sh');
-- insert into sys_file(id,file_name,location,size,media_type,file_type)values('T001_ops_s_6','deploy_was_single.sh','/script/T001/deploy_was_single.sh',10000,'text/x-sh','sh');
-- insert into sys_file(id,file_name,location,size,media_type,file_type)values('T001_ops_s_8','backup_db2.sh','/script/T001/backup_db2.sh',10000,'text/x-sh','sh');
-- insert into sys_file(id,file_name,location,size,media_type,file_type)values('T001_ops_s_9','backup_mysql.sh','/script/T001/backup_mysql.sh',10000,'text/x-sh','sh');
-- Action File
delete from ops_auto_action_script where id like 'T001_ops_s_%';
insert into ops_auto_action_script(id,name,file_name,file_id,tenant_id)values('T001_ops_s_1','deploy_tomcat.sh','deploy_tomcat.sh','T001_ops_s_1','T001');
insert into ops_auto_action_script(id,name,file_name,file_id,tenant_id)values('T001_ops_s_2','deploy_nginx.sh','deploy_nginx.sh','T001_ops_s_2','T001');
insert into ops_auto_action_script(id,name,file_name,file_id,tenant_id)values('T001_ops_s_3','deploy_mysql.sh','deploy_mysql.sh','T001_ops_s_3','T001');
insert into ops_auto_action_script(id,name,file_name,file_id,tenant_id)values('T001_ops_s_7','deploy_redis_single.sh','deploy_redis_single.sh','T001_ops_s_7','T001');
-- insert into ops_auto_action_script(id,name,file_name,file_id,tenant_id)values('T001_ops_s_4','deploy_db2.sh','deploy_db2.sh','T001_ops_s_4','T001');
-- insert into ops_auto_action_script(id,name,file_name,file_id,tenant_id)values('T001_ops_s_5','deploy_zabbix_agent.sh','deploy_zabbix_agent.sh','T001_ops_s_5','T001');
-- insert into ops_auto_action_script(id,name,file_name,file_id,tenant_id)values('T001_ops_s_6','deploy_was_single.sh','deploy_was_single.sh','T001_ops_s_6','T001');
-- insert into ops_auto_action_script(id,name,file_name,file_id,tenant_id)values('T001_ops_s_8','backup_db2.sh','backup_db2.sh','T001_ops_s_8','T001');
-- insert into ops_auto_action_script(id,name,file_name,file_id,tenant_id)values('T001_ops_s_9','backup_mysql.sh','backup_mysql.sh','T001_ops_s_9','T001');
delete from ops_auto_action where id not like 'T001%';
delete from ops_auto_task where id not like 'T001%';
INSERT INTO `ops_auto_task` (`id`, `owner_id`, `name`, `status`, `run_status`, `group_id`, `batch_id`, `action_id`, `conf_content`, `notes`, `selected_code`, `update_by`, `update_time`, `deleted`, `delete_by`, `delete_time`, `version`, `tenant_id`, `create_by`, `create_time`)
VALUES
('T001_mysql', 'task', 'Linux部署mysql', 'enable', NULL, NULL, '', 'T001_mysql', '[]', '', '1693566914000', NULL, NULL, 0, NULL, NULL, 1, 'T001', '110588348101165911', '2023-09-01 19:15:30'),
('T001_nginx', 'task', 'Linux部署nginx', 'enable', 'finish', NULL, '', 'T001_nginx', '[]', '', '1693620001000', NULL, '2023-09-02 10:12:49', 0, NULL, NULL, 8, 'T001', '110588348101165911', '2023-09-01 19:15:53'),
('T001_redis', 'task', 'Linux部署redis', 'enable', 'finish', NULL, '', 'T001_redis', '[]', '', '1693619841000', NULL, '2023-09-02 09:59:48', 0, NULL, NULL, 9, 'T001', '110588348101165911', '2023-09-01 19:15:13'),
('T001_test', 'task', 'Linux自动运行测试', 'enable', 'finish', NULL, '', 'T001_test', '', '', '1693567086000', '110588348101165911', '2023-09-01 19:18:10', 0, NULL, NULL, 66, 'T001', NULL, NULL),
('T001_tomcat', 'task', 'Linux部署tomcat', 'enable', 'finish', NULL, '', 'T001_tomcat', '[]', '', '1693619283000', NULL, '2023-09-02 10:03:31', 0, NULL, NULL, 12, 'T001', '110588348101165911', '2023-09-01 19:12:56');
INSERT INTO `ops_auto_action` (`id`, `name`, `status`, `type`, `tpl_version`, `support`, `info`, `file_status`, `node_number_type`, `conf_content`, `example_conf_content`, `execute_content`, `execute_tool`, `notes`, `create_by`, `create_time`, `update_by`, `update_time`, `deleted`, `delete_by`, `delete_time`, `version`, `tenant_id`)
VALUES
('T001_base', 'Linux安全基线', 'enable', 'host', '1.0.0', '适用Linux', '略', 'enable', '1', '{\n	\"ip\": \"1.1.1.1\",\n	\"vars\": [\n             {\"key\": \"action\",\"value\": \"1\"}\n       ]\n}', '[\n{\n	\"vars\": [\n             {\"key\": \"action\",\"value\": \"1\"}\n       ]\n}\n]', '#!/bin/sh\n#version 1.2.3 modify at 20210412\n#sh cmd.sh \naction=<##action##>\necho \"\"\necho \"########## check profile timeout\"\nc=`cat /etc/profile|grep -v \"#\"|grep TMOUT|wc -l`\nif [[ $c -eq 0 ]];then\n	echo \"failed\"\n	if [[ $action -eq 1 ]];then\n		echo \"TMOUT=180\">>/etc/profile\n		echo \"export TMOUT\">>/etc/profile\n		echo \"set success\"\n	fi\nelse\n	echo \"success\"\nfi\necho \"########## check rsyslog\"\nif [[ -f /etc/rsyslog.conf ]];then\n	logcnt=`cat /etc/rsyslog.conf|grep -v \"#\"|grep 10.21.1.115|wc -l`\n	if [[ $logcnt -eq 0 ]];then\n		echo \"failed\"\n		if [[ $action -eq 1 ]];then\n			echo \"*.* @10.21.1.115\">>/etc/rsyslog.conf\n			echo \"set success\"\n		fi\n	else\n		echo \"success\" \n	fi\nfi\necho \"########## check system-auth\"\nif [[ -f /etc/pam.d/system-auth ]];then\n	authcnt=`cat /etc/pam.d/system-auth|grep pam_tally.so|wc -l`\n	if [[ $authcnt -eq 0 ]];then\n		echo \"failed\"\n		if [[ $action -eq 1 ]];then\n			echo \"auth required /lib/security/\\$ISA/pam_tally.so onerr=fail no_magic_root      \">>/etc/pam.d/system-auth\n			echo \"account required /lib/security/\\$ISA/pam_tally.so deny=6 no_magic_root reset \">>/etc/pam.d/system-auth\n			echo \"password requisite  pam_cracklib.so try_first_pass retry=3 difok=3 minlen=8 dcredit=-1 ucredit=-1 lcredit=-1 ocredit=-1\" >>/etc/pam.d/system-auth\n			echo \"password sufficient pam_unix.so sha512 shadow nullok try_first_pass use_authtok remember=5\" >>/etc/pam.d/system-auth\n			echo \"set success\"\n		fi\n	else\n		echo \"success\"\n	fi\nfi\necho \"########## check PASS_MAX_DAYS\"\ndvalue=`cat /etc/login.defs|grep -v \"#\"|grep PASS_MAX_DAYS|awk \'{print $NF}\'`\nif [[ $dvalue -eq 90 ]];then\n	echo \"success\"\nelse\n	echo \"failed\"\n	if [[ $action -eq 1 ]];then\n		sed -i \'/PASS_MAX_DAYS/d\' /etc/login.defs\n		echo \"PASS_MAX_DAYS 90\">>/etc/login.defs\n		echo \"set success\"\n	fi\nfi\necho \"########## check PASS_MIN_LEN\"\ndvalue=`cat /etc/login.defs|grep -v \"#\"|grep PASS_MIN_LEN|awk \'{print $NF}\'`\nif [[ $dvalue -eq 8 ]];then\n	echo \"success\"\nelse\n	echo \"failed\"\n	if [[ $action -eq 1 ]];then\n		sed -i \'/PASS_MIN_LEN/d\' /etc/login.defs\n		echo \"PASS_MIN_LEN 8\">>/etc/login.defs\n		echo \"set success\"\n	fi\nfi\necho \"########## check zabbix agent autostart\"\nzpath=`which zabbix_agentd 2>&1>/dev/null`\nif [[ $? -eq 0 ]];then\n	echo \"success\"\n	zcnt=`cat /etc/rc.d/rc.local|grep zabbix|wc -l`\n	if [[ $zcnt -eq 0 ]];then\n		chmod +x /etc/rc.d/rc.local\n		echo \"$zpath\">>/etc/rc.d/rc.local\n	fi\nelse\n    echo \"failed\"\nfi\necho \"########## check selinux\"\nsediscnt=`cat /etc/selinux/config |grep -v \"#\"|grep disabled|wc -l`\nif [[ $sediscnt -eq 1 ]];then\n	echo \"success\"\nelse\n	echo \"failed\"\n	if [[ $action -eq 1 ]];then\n		sed -i \'s/SELINUX=enforcing/SELINUX=disabled/\' /etc/selinux/config\n	fi\nfi\necho \"########## check /etc/rc.d/rc.local\"\ncat /etc/rc.d/rc.local|grep -v \"#\"|grep -v \"lock/subsys\"\necho \"########## check rhost\"\necho \"hosts.allow list\"\ncat /etc/hosts.allow|grep -v \"#\"\n#echo \"sshd:10.7.5.27:allow\">>/etc/hosts.allow\necho \"hosts.allow deny\"\ncat /etc/hosts.deny|grep -v \"#\"\n#echo \"sshd:all:deny\">>/etc/hosts.deny\necho \"########## check port\"\nnetstat -ant|grep LISTEN\nexit 0\n\n', 'ops_tool', '', NULL, NULL, '110588348101165911', '2023-09-01 18:59:34', 1, '110588348101165911', '2023-09-01 18:59:34', 8, 'T001'),
('T001_modify_root', 'Linux超级管理员账户密码重置(root)', 'enable', 'host', '1.0', 'linux修改root密码', '略', 'enable', '1', '{}', '[]', '#!/bin/bash\n#echo \'oracle123456\'  |passwd --stdin root\necho \"success\"\nexit 0', 'ops_tool', '', NULL, NULL, '110588348101165911', '2023-09-01 19:14:00', 0, NULL, NULL, 7, 'T001'),
('T001_mysql', 'Linux部署MySQL', 'enable', 'host', '1.0', 'Linux 7.9环境,mysql版本5.7.43 /app/mysql目录', '略', 'enable', '1', '{}', '[]', '#!/bin/sh\ncd /tmp\nsh deploy_mysql.sh mysql.tar.gz /app/mysql P@ssw0rd123456\nexit 0', 'ops_tool', NULL, '110588348101165911', '2023-09-01 18:59:50', '110588348101165911', '2023-09-02 09:17:28', 0, NULL, NULL, 5, 'T001'),
('T001_nginx', 'Linux 部署Nginx', 'enable', 'host', '1.0', 'Linux 7.9环境,nginx 版本1.24 /app/nginx目录', '略', 'enable', '1', '{}', '[]', '#!/bin/sh\ncd /tmp\nsh deploy_nginx.sh nginx.tar.gz /app/nginx nginx\nexit 0', 'ops_tool', NULL, NULL, NULL, '110588348101165911', '2023-09-02 10:11:50', 0, NULL, NULL, 9, 'T001'),
('T001_redis', 'Linux部署Redis', 'enable', 'host', '1.0', 'Linux 7.9环境,redis 版本5.0.14 /app/redis目录', '略', 'enable', '1', '{}', '[]', '#!/bin/sh\ncd /tmp\nsh deploy_redis_single.sh redis.tar.gz /app/redis redis 6379\nexit 0', 'ops_tool', NULL, '110588348101165911', '2023-09-01 18:58:59', '110588348101165911', '2023-09-01 19:31:04', 0, NULL, NULL, 5, 'T001'),
('T001_test', 'Linux部署测试', 'enable', 'host', '1.0', '测试', NULL, 'enable', '1', '{}', '[]', '#!/bin/bash\n\necho \"test\"\nexit 0', 'ops_tool', NULL, '110588348101165911', '2023-09-01 19:13:47', '110588348101165911', '2023-09-01 19:18:54', 0, NULL, NULL, 2, 'T001'),
('T001_tomcat', 'Linux部署Tomcat', 'enable', 'host', '1.0', 'Linux 7.9环境,tomcat 版本9.0.80 /app/tomcat目录', '略', 'enable', '1', '{}', '[]', '#!/bin/sh\ncd /tmp\nsh deploy_tomcat.sh /app/tomcat tomcat.tar.gz app 8080\nexit 0\n', 'ops_tool', '', NULL, NULL, '110588348101165911', '2023-09-02 10:02:38', 0, NULL, NULL, 17, 'T001');
