var A=Object.defineProperty,B=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var N=(e,t,o)=>t in e?A(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,l=(e,t)=>{for(var o in t||(t={}))V.call(t,o)&&N(e,o,t[o]);if(w)for(var o of w(t))k.call(t,o)&&N(e,o,t[o]);return e},u=(e,t)=>B(e,F(t));var h=(e,t,o)=>new Promise((s,r)=>{var d=n=>{try{E(o.next(n))}catch(i){r(i)}},f=n=>{try{E(o.throw(n))}catch(i){r(i)}},E=n=>n.done?s(n.value):Promise.resolve(n.value).then(d,f);E((o=o.apply(e,t)).next())});import{L as p,ci as L,aK as g,aL as O,B as G,J as I,ay as m,I as T,bd as K}from"./index-c6cc3b14.js";import{u as P,a as $,C as D,e as J,f as b}from"./chartEditStore-3ee495ca.js";import{u as x,C as H}from"./chartLayoutStore-fa484834.js";import{f as q,d as W,e as z}from"./index-68969097.js";import{g as Q}from"./plugin-0dcb0bd6.js";const X=e=>e,Y=(e,t)=>{try{if(t.id){const o="vnodeBeforeMount"in t.events,s="vnodeMounted"in t.events;return o&&(e.events.advancedEvents.vnodeBeforeMount=t==null?void 0:t.events.vnodeBeforeMount),s&&(e.events.advancedEvents.vnodeMounted=t==null?void 0:t.events.vnodeMounted),(o||s)&&(t.events={baseEvent:{[g.ON_CLICK]:void 0,[g.ON_DBL_CLICK]:void 0,[g.ON_MOUSE_ENTER]:void 0,[g.ON_MOUSE_LEAVE]:void 0},advancedEvents:{[O.VNODE_MOUNTED]:void 0,[O.VNODE_BEFORE_MOUNT]:void 0},interactEvents:[]}),e}}catch(o){return e}},C=(e,t,o=!1)=>{if(Y(e,t),o)return L(e,t);const s=t.option;if(!s)return L(e,t);if(t.option=void 0,s)return u(l({},L(e,t)),{option:s})},Z=()=>{const e=P(),t=$(),o=x();return{updateComponent:(r,d=!1,f=!1)=>h(void 0,null,function*(){d&&(e.componentList=[],t.clearBackStack(),t.clearForwardStack()),r.editCanvasConfig=X(r.editCanvasConfig),r.componentList.forEach(n=>h(void 0,null,function*(){const i=a=>{window.$vue.component(a.chartConfig.chartKey)||(window.$vue.component(a.chartConfig.chartKey,q(a.chartConfig)),window.$vue.component(a.chartConfig.conKey,W(a.chartConfig)))};n.isGroup?n.groupList.forEach(a=>{i(a)}):i(n)}));const E=(n,i)=>h(void 0,null,function*(){let a=yield z(n.chartConfig);n.chartConfig.redirectComponent&&(n.chartConfig.dataset&&(a.option.dataset=n.chartConfig.dataset),a.chartConfig.title=n.chartConfig.title,a.chartConfig.chartFrame=n.chartConfig.chartFrame),i?i(f?C(a,u(l({},n),{id:p()})):C(a,n)):f?e.addComponentList(C(a,u(l({},n),{id:p()})),!1,!0):e.addComponentList(C(a,n),!1,!0)});for(const n in r)if(n===D.COMPONENT_LIST){let i=0;const a=r[n].length;for(const v of r[n]){let y=parseInt((parseFloat(`${++i/a}`)*100).toString());if(o.setItemUnHandle(H.PERCENTAGE,y),v.isGroup){let c=new J;f?c=C(c,u(l({},v),{id:p()})):c=C(c,v);const M=[];for(const R of v.groupList)yield E(R,_=>{M.push(_)});c.groupList=M,e.addComponentList(c,!1,!0)}else yield E(v);y===100&&(t.clearBackStack(),t.clearForwardStack())}}else{if(n!=="editCanvasConfig"&&n!=="requestGlobalConfig")return;C(e[n],r[n],!0)}o.setItemUnHandle(H.PERCENTAGE,0)})}},{updateComponent:j}=Z(),S=P(),rt=()=>{Q({message:"是否覆盖源视图内容，此操作不可撤回?",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{window.$message.success("正在同步编辑器..."),dispatchEvent(new CustomEvent(m.CHART,{detail:S.getStorageInfo}))}})},U=()=>{dispatchEvent(new CustomEvent(m.CHART_TO_PREVIEW,{detail:S.getStorageInfo}))},tt=()=>{const e=d=>{window.$message.success("正在进行更新..."),j(d.detail,!0)},t=()=>{S.setEditCanvas(b.IS_CODE_EDIT,!1)},o=()=>{addEventListener("blur",U),addEventListener(m.JSON,e),addEventListener(m.CLOSE,K(t,1e3))},s=()=>{removeEventListener("blur",U),removeEventListener(m.JSON,e)};return(d,f)=>{f==T.CHART_HOME_NAME&&s(),d==T.CHART_HOME_NAME&&o()}},dt=()=>{const e=G();I(()=>e.name,tt(),{immediate:!0})};export{dt as a,rt as s,Z as u};
