var me=Object.defineProperty,fe=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var le=(l,r,u)=>r in l?me(l,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):l[r]=u,J=(l,r)=>{for(var u in r||(r={}))ve.call(r,u)&&le(l,u,r[u]);if(oe)for(var u of oe(r))he.call(r,u)&&le(l,u,r[u]);return l},Q=(l,r)=>fe(l,ge(r));var se=(l,r,u)=>new Promise((h,b)=>{var y=d=>{try{p(u.next(d))}catch(q){b(q)}},_=d=>{try{p(u.throw(d))}catch(q){b(q)}},p=d=>d.done?h(d.value):Promise.resolve(d.value).then(y,_);p((u=u.apply(l,r)).next())});import{d as L,j as E,J as X,r as o,o as i,D as H,w as t,e,f as v,c as C,q as g,u as a,h as V,b5 as ie,l as _e,W as Z,Y as G,a2 as te,F as Y,s as ae,am as de,t as A,z as be,A as ye,p as qe,cQ as B,aG as W,cP as re,aH as M,a6 as xe,L as we,aD as ce,a4 as K,cp as Pe,cq as De,bf as Ie}from"./index-c6cc3b14.js";import{i as ee}from"./icon-8314374d.js";import{c as Ce}from"./http-abbaebe7.js";/* empty css                                                                       */import{S as T}from"./SettingItemBox-cf908047.js";import{r as ke}from"./chartEditStore-3ee495ca.js";import{n as Se}from"./noData-9e194391.js";import{u as ne}from"./useTargetData.hook-5f5f1f2c.js";import{g as pe}from"./plugin-0dcb0bd6.js";import"./index-fa8f8e54.js";import{R as Re,a as $e}from"./pondIndex.vue_vue_type_style_index_0_scoped_de860d6d_lang-5e6f8b0d.js";import"./EditorWorker-df02f0e7.js";import"./editorWorker-43a98755.js";import{S as j}from"./SettingItem-ec2fd044.js";import{l as Ee}from"./lodash-c32566df.js";import{C as Oe}from"./index-9631b53b.js";import"./index-af8cb105.js";import"./fileTypeEnum-21359a08.js";const He={class:"go-pr-3"},Te={key:1},Ue=L({__name:"pondIndex",props:{modelShow:Boolean,targetDataRequest:Object},emits:["update:modelShow","editSaveHandle"],setup(l,{emit:r}){const u=l;E();const h=E(),b=E(!1);X(()=>u.modelShow,p=>{b.value=p});const y=()=>{r("update:modelShow",!1)},_=()=>{var p,d;if(!((p=u.targetDataRequest)!=null&&p.dataPondName)){window.$message.warning("请在左下角输入名称！"),(d=h.value)==null||d.focus();return}pe({message:"保存内容将同步修改所有使用此接口的组件, 是否继续?",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{r("update:modelShow",!1),r("editSaveHandle",u.targetDataRequest)}})};return(p,d)=>{const q=o("n-space"),D=o("n-scrollbar"),m=o("n-tag"),x=o("n-input"),w=o("n-button"),k=o("n-card"),O=o("n-modal");return i(),H(O,{class:"go-chart-data-request",show:b.value,"onUpdate:show":d[1]||(d[1]=P=>b.value=P),"mask-closable":!1,closeOnEsc:!1},{default:t(()=>[e(k,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"1000px",height:"800px"}},{header:t(()=>[]),"header-extra":t(()=>[]),action:t(()=>[e(q,{justify:"space-between"},{default:t(()=>[l.targetDataRequest?(i(),H(q,{key:0},{default:t(()=>[e(m,{bordered:!1,type:"primary"},{default:t(()=>[v("名称：")]),_:1}),e(x,{value:l.targetDataRequest.dataPondName,"onUpdate:value":d[0]||(d[0]=P=>l.targetDataRequest.dataPondName=P),ref_key:"inputInstRef",ref:h,type:"text",size:"small",autofocus:!0,clearable:!0,minlength:1,maxlength:16,placeholder:"请输入名称"},null,8,["value"])]),_:1})):(i(),C("span",Te)),e(q,null,{default:t(()=>[e(w,{onClick:y},{default:t(()=>[v("取消")]),_:1}),e(w,{type:"primary",onClick:_},{default:t(()=>[v("保存")]),_:1})]),_:1})]),_:1})]),default:t(()=>[e(D,{style:{"max-height":"718px"}},{default:t(()=>[g("div",He,[e(q,{vertical:""},{default:t(()=>{var P;return[e(a(Re)),e(a($e),{"target-data-request":(P=l.targetDataRequest)==null?void 0:P.dataPondRequestConfig},null,8,["target-data-request"])]}),_:1})])]),_:1})]),_:1})]),_:1},8,["show"])}}}),ze=V(Ue,[["__scopeId","data-v-de860d6d"]]),Ne=l=>(be("data-v-43dfb7fe"),l=l(),ye(),l),Be={class:"go-chart-data-pond-list"},Ae={class:"pond-item-box"},Fe=Ne(()=>g("span",null," 创建 ",-1)),je=["onClick"],Le={class:"item-content"},Me={class:"item-content-body"},Ge=["onClick"],Ve=L({__name:"index",emits:["createPond","deletePond"],setup(l,{emit:r}){ie(w=>({"1013e1a5":q.value}));const{DuplicateOutlineIcon:u,TrashIcon:h}=ee.ionicons5,b=_e(),{chartEditStore:y,targetData:_}=ne(),{requestDataPond:p}=Z(y.getRequestGlobalConfig),d=G(()=>_.value.request.requestDataPondId),q=G(()=>b.getAppTheme),D=()=>{r("createPond",!0)},m=(w,k)=>{w.stopPropagation(),w.preventDefault(),r("deletePond",k)},x=w=>{_.value.request.requestDataPondId=w.dataPondId};return(w,k)=>{const O=o("n-timeline-item"),P=o("n-timeline"),I=o("n-icon"),z=o("n-button"),U=o("n-divider"),n=o("n-a"),s=o("n-text"),f=o("n-space"),R=o("n-tag"),S=o("n-ellipsis"),N=o("n-scrollbar");return i(),C("div",Be,[e(P,{class:"pond-item-timeline",style:{width:"20px"}},{default:t(()=>[e(O,{type:"info"}),e(O,{type:"success"})]),_:1}),g("div",Ae,[e(z,{class:"create-btn go-py-4",ghost:"",onClick:D},{icon:t(()=>[e(I,null,{default:t(()=>[e(a(u))]),_:1})]),default:t(()=>[Fe]),_:1}),e(U,{style:{margin:"10px 0"}}),a(p).length?te("",!0):(i(),H(f,{key:0,justify:"center"},{default:t(()=>[e(s,{class:"not-layer-text",depth:3},{default:t(()=>[v(" 暂无数据内容， "),e(n,{onClick:D},{default:t(()=>[v("立即创建")]),_:1})]),_:1})]),_:1})),e(N,{style:{"max-height":"490px"}},{default:t(()=>[(i(!0),C(Y,null,ae(a(p),c=>(i(),C("div",{key:c.dataPondId,class:de([{select:c.dataPondId===d.value},"pond-item"]),onClick:F=>x(c)},[g("div",Le,[g("div",Me,[g("div",null,[e(R,{class:"go-mr-1",type:c.dataPondId===d.value?"warning":"",bordered:!1},{default:t(()=>[v(" 名称 ")]),_:2},1032,["type"]),e(S,{style:{"max-width":"180px"}},{default:t(()=>[v(A(c.dataPondName||"暂无"),1)]),_:2},1024)]),g("div",null,[e(R,{class:"go-mr-1",type:c.dataPondId===d.value?"warning":"",bordered:!1},{default:t(()=>[v(" 地址 ")]),_:2},1032,["type"]),e(S,{style:{"max-width":"180px"}},{default:t(()=>[v(A(c.dataPondRequestConfig.requestUrl||"暂无"),1)]),_:2},1024)])]),g("div",{class:"item-content-icon go-transition-quick",onClick:F=>m(F,c)},[e(I,null,{default:t(()=>[e(a(h))]),_:1})],8,Ge)]),g("div",{class:de({"select-modal":c.dataPondId===d.value})},null,2)],10,je))),128))]),_:1})])])}}});const Ye=V(Ve,[["__scopeId","data-v-43dfb7fe"]]),Je=g("thead",null,[g("tr",null,[g("th",null,"key"),g("th",null,"value")])],-1),ue=L({__name:"displayTable",props:{target:Object},setup(l){const r=l,u={key:"",value:""},h=qe({content:[]});return X(()=>r.target,b=>{h.content=[];for(const y in b)h.content.push({key:y,value:b[y]});h.content.length||(h.content=[JSON.parse(JSON.stringify(u))])},{immediate:!0,deep:!0}),(b,y)=>{const _=o("n-table");return i(),H(_,{bordered:!1,"single-line":!1,size:"small",style:{"border-bottom-right-radius":"7px","border-bottom-left-radius":"7px"}},{default:t(()=>[Je,g("tbody",null,[(i(!0),C(Y,null,ae(h.content,(p,d)=>(i(),C("tr",{key:d},[g("td",null,A(p.key||"暂无"),1),g("td",null,A(p.value||"暂无"),1)]))),128))])]),_:1})}}}),Qe={class:"go-chart-data-display"},We={class:"go-mr-3"},Xe={key:0},Ke={class:"go-mt-3"},Ze={key:0},et={key:1},tt={key:1},at=L({__name:"index",props:{globalData:Object,targetData:Object},setup(l){const r=l,{HelpOutlineIcon:u,FlashIcon:h,PulseIcon:b}=ee.ionicons5,{requestUrl:y,requestInterval:_,requestHttpType:p,requestContentType:d,requestSQLContent:q,requestParams:D,requestParamsBodyType:m,requestIntervalUnit:x}=Z(r.targetData.dataPondRequestConfig);B.HEADER;const w={[W.DEFAULT]:"普通请求",[W.SQL]:"SQL 请求"},k=E(B.PARAMS);return(O,P)=>{const I=o("n-input"),z=o("n-icon"),U=o("n-divider"),n=o("n-tab"),s=o("n-tabs"),f=o("n-text"),R=o("n-card"),S=o("n-code"),N=o("n-scrollbar");return i(),C("div",Qe,[e(N,{style:{"max-height":"570px"}},{default:t(()=>[g("div",We,[g("div",null,[e(a(T),{name:"主体信息"},{default:t(()=>[e(a(j),{name:"接口名称"},{default:t(()=>{var c;return[e(I,{size:"small",placeholder:((c=l.targetData)==null?void 0:c.dataPondName)||"暂无",disabled:!0},null,8,["placeholder"])]}),_:1}),e(a(j),{name:"接口类型"},{default:t(()=>[e(I,{size:"small",placeholder:a(p)||"暂无",disabled:!0},null,8,["placeholder"])]),_:1})]),_:1}),e(a(T),null,{default:t(()=>[e(a(j),{name:"组件间隔"},{default:t(()=>[e(I,{size:"small",placeholder:`${a(_)||"暂无"}`,disabled:!0},{suffix:t(()=>[v(A(l.targetData&&a(re)[a(x)]),1)]),_:1},8,["placeholder"])]),_:1}),e(a(j),{name:"全局间隔（默认）"},{default:t(()=>{var c;return[e(I,{size:"small",placeholder:`${((c=l.globalData)==null?void 0:c.requestInterval)||"暂无"}`,disabled:!0},{suffix:t(()=>[v(A(l.globalData&&a(re)[l.globalData.requestIntervalUnit]),1)]),_:1},8,["placeholder"])]}),_:1})]),_:1}),e(a(T),{name:"源地址",alone:!0},{default:t(()=>{var c;return[e(I,{size:"small",placeholder:((c=l.globalData)==null?void 0:c.requestOriginUrl)||"暂无",disabled:!0},{prefix:t(()=>[e(z,{component:a(b)},null,8,["component"])]),_:1},8,["placeholder"])]}),_:1}),e(a(T),{name:"接口地址",alone:!0},{default:t(()=>[e(I,{size:"small",placeholder:a(y)||"暂无",disabled:!0},{prefix:t(()=>[e(z,{component:a(h)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1})]),e(U),e(a(T),{name:"类型"},{default:t(()=>[e(a(j),{name:"配置类型"},{default:t(()=>[e(I,{size:"small",placeholder:l.targetData&&w[a(d)],disabled:!0},null,8,["placeholder"])]),_:1}),a(d)===a(W).DEFAULT?(i(),H(a(j),{key:0,name:"body 类型"},{default:t(()=>[e(I,{size:"small",placeholder:l.targetData&&a(m),disabled:!0},null,8,["placeholder"])]),_:1})):te("",!0)]),_:1}),a(d)===a(W).DEFAULT?(i(),C("div",Xe,[e(s,{type:"line",animated:"",value:k.value,"onUpdate:value":P[0]||(P[0]=c=>k.value=c)},{default:t(()=>[(i(!0),C(Y,null,ae(a(B),c=>(i(),H(n,{key:c,name:c,tab:c},{default:t(()=>[v(A(c),1)]),_:2},1032,["name","tab"]))),128))]),_:1},8,["value"]),g("div",Ke,[k.value!==a(B).BODY?(i(),C("div",Ze,[e(ue,{class:"go-my-3",target:a(D)[k.value]},null,8,["target"])])):(i(),C("div",et,[a(m)===a(M).NONE?(i(),H(R,{key:0,class:"go-mt-3 go-pb-3"},{default:t(()=>[e(f,{depth:"3"},{default:t(()=>[v("该接口没有 Body 体")]),_:1})]),_:1})):a(m)===a(M).FORM_DATA||a(m)===a(M).X_WWW_FORM_URLENCODED?(i(),H(ue,{key:1,class:"go-my-3",target:a(D)[a(B).BODY][a(m)]},null,8,["target"])):a(m)===a(M).JSON?(i(),H(R,{key:2,size:"small",style:{"padding-bottom":"7px"}},{default:t(()=>[e(S,{code:a(D)[a(B).BODY][a(m)]||"暂无内容",language:"json"},null,8,["code"])]),_:1})):a(m)===a(M).XML?(i(),H(S,{key:3,code:a(D)[a(B).BODY][a(m)]||"",language:"html"},null,8,["code"])):te("",!0)]))])])):(i(),C("div",tt,[e(a(T),{name:"键名"},{default:t(()=>[e(f,null,{default:t(()=>[v("sql")]),_:1})]),_:1}),e(a(T),{name:"键值"},{default:t(()=>[e(S,{code:a(q).sql||"",language:"sql"},null,8,["code"])]),_:1})]))])]),_:1})])}}});const nt=V(at,[["__scopeId","data-v-cc877db2"]]),ot={class:"pond-content"},lt={key:1,class:"no-data go-flex-center"},st=["src"],dt=L({__name:"index",props:{modelShow:Boolean},emits:["update:modelShow","sendHandle"],setup(l,{emit:r}){const u=l,{PencilIcon:h}=ee.ionicons5,{chartEditStore:b,targetData:y}=ne(),{requestDataPond:_}=Z(b.getRequestGlobalConfig),p=E(!1),d=E(!1),q=E(!1),D=E(!1),m=E(),x=G(()=>{var f,R;const n=(R=(f=y==null?void 0:y.value)==null?void 0:f.request)==null?void 0:R.requestDataPondId;return n?_.value.filter(S=>n===S.dataPondId)[0]:void 0});X(()=>u.modelShow,n=>{d.value=n}),X(()=>x.value,n=>{q.value=!0,m.value=n,xe(()=>{q.value=!1})},{immediate:!0});const w=(n=!1)=>{D.value=!!n,p.value=!0},k=()=>{const n=we();m.value={dataPondId:n,dataPondName:n,dataPondRequestConfig:Ee.cloneDeep(Q(J({},ke),{requestDataType:ce.Pond}))},w()},O=n=>{D.value?P(n):I(n),D.value=!1,p.value=!1},P=n=>{try{const s=_.value.findIndex(f=>f.dataPondId===n.dataPondId);s!==-1?(_.value.splice(s,1,n),b.getComponentList.forEach(f=>{f.request.requestDataType===ce.Pond&&f.request.requestDataPondId===n.dataPondId&&(f.request=Q(J({},K(n.dataPondRequestConfig)),{requestDataPondId:n.dataPondId}))}),window.$message.success("保存成功！")):window.$message.error("编辑失败，请稍后重试！")}catch(s){window.$message.error("编辑失败，请稍后重试！")}},I=n=>{try{m.value?(_.value.unshift(n),window.$message.success("创建成功!")):window.$message.error("创建失败，请稍后重试!")}catch(s){window.$message.error("创建失败，请稍后重试!")}},z=n=>{pe({message:"删除数据后，需手动处理使用改接口的组件，是否继续？",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{const s=_.value.findIndex(f=>f.dataPondId===n.dataPondId);s!==-1?(_.value.splice(s,1),window.$message.success("删除成功!")):window.$message.error("删除失败，请稍后重试！")}})},U=()=>{x.value&&(y.value.request=Q(J({},K(x.value.dataPondRequestConfig)),{requestDataPondId:x.value.dataPondId})),r("update:modelShow",!1),r("sendHandle")};return(n,s)=>{const f=o("n-text"),R=o("n-icon"),S=o("n-button"),N=o("n-space"),c=o("n-card"),F=o("n-modal");return i(),C(Y,null,[e(F,{class:"go-chart-data-pond-control",show:d.value,"onUpdate:show":s[1]||(s[1]=$=>d.value=$),"mask-closable":!1},{default:t(()=>[e(c,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"900px",height:"650px"}},{header:t(()=>[]),"header-extra":t(()=>[]),action:t(()=>[e(N,{justify:"space-between"},{default:t(()=>[e(S,{type:"info",secondary:"",disabled:!x.value,onClick:s[0]||(s[0]=$=>w(!0))},{icon:t(()=>[e(R,null,{default:t(()=>[e(a(h))]),_:1})]),default:t(()=>[v(" 编辑内容 ")]),_:1},8,["disabled"]),e(S,{type:"primary",onClick:U},{default:t(()=>[v("保存 & 发送请求")]),_:1})]),_:1})]),default:t(()=>[g("div",ot,[x.value&&!q.value?(i(),H(a(nt),{key:0,targetData:x.value,globalData:a(b).getRequestGlobalConfig},null,8,["targetData","globalData"])):(i(),C("div",lt,[g("img",{src:a(Se),alt:"暂无数据"},null,8,st),e(f,{depth:3},{default:t(()=>[v("暂未选择公共接口")]),_:1})])),e(a(Ye),{onCreatePond:k,onDeletePond:z})])]),_:1})]),_:1},8,["show"]),e(a(ze),{modelShow:p.value,"onUpdate:modelShow":s[2]||(s[2]=$=>p.value=$),targetDataRequest:m.value,isEdit:D.value,onEditSaveHandle:O},null,8,["modelShow","targetDataRequest","isEdit"])],64)}}});const rt=V(dt,[["__scopeId","data-v-f251a5df"]]),ct={class:"go-chart-data-pond"},ut={class:"go-absolute-center"},it=L({__name:"index",setup(l){ie(n=>({"74c9eabc":I.value}));const r=_e(),{HelpOutlineIcon:u,FlashIcon:h,PulseIcon:b,FishIcon:y}=ee.ionicons5,{targetData:_,chartEditStore:p}=ne(),{requestDataPond:d,requestInterval:q,requestIntervalUnit:D}=Z(p.getRequestGlobalConfig),m=E(!1),x=E(!1),w=E(!1);let k=0,O;const P=G(()=>{const n=_.value.request.requestDataPondId;return n?d.value.filter(f=>n===f.dataPondId)[0]:void 0}),I=G(()=>r.getAppTheme),z=()=>{x.value=!0},U=()=>se(this,null,function*(){var n;if(!((n=_.value)!=null&&n.request)){window.$message.warning("请选择一个公共接口！");return}m.value=!0;try{const s=yield Ce(K(_.value.request),K(p.getRequestGlobalConfig));if(m.value=!1,s){!(s!=null&&s.data)&&!_.value.filter&&window.$message.warning("您的数据不符合默认格式，请配置过滤器！"),_.value.option.dataset=Ie(s==null?void 0:s.data,s,_.value.filter),w.value=!0;return}window.$message.warning("没有拿到返回值，请检查接口！")}catch(s){console.error(s),m.value=!1,window.$message.warning("数据异常，请检查参数！")}});return Pe(()=>{var s;const n=(s=_.value)==null?void 0:s.filter;O!==n&&k&&(O=n,U()),k++}),De(()=>{O=null}),(n,s)=>{const f=o("n-icon"),R=o("n-input"),S=o("n-button"),N=o("n-card"),c=o("n-tooltip"),F=o("go-skeleton");return i(),C(Y,null,[g("div",ct,[e(N,{class:"n-card-shallow"},{default:t(()=>[e(a(T),{name:"请求名称",alone:!0},{default:t(()=>{var $;return[e(R,{size:"small",placeholder:(($=P.value)==null?void 0:$.dataPondName)||"暂无",disabled:!0},{prefix:t(()=>[e(f,{component:a(y)},null,8,["component"])]),_:1},8,["placeholder"])]}),_:1}),e(a(T),{name:"接口地址",alone:!0},{default:t(()=>{var $;return[e(R,{size:"small",placeholder:(($=P.value)==null?void 0:$.dataPondRequestConfig.requestUrl)||"暂无",disabled:!0},{prefix:t(()=>[e(f,{component:a(h)},null,8,["component"])]),_:1},8,["placeholder"])]}),_:1}),g("div",{class:"edit-text",onClick:z},[g("div",ut,[e(S,{type:"primary",secondary:""},{default:t(()=>[v("编辑配置")]),_:1})])])]),_:1})]),e(a(T),{alone:!0},{name:t(()=>[v(" 测试 "),e(c,{trigger:"hover"},{trigger:t(()=>[e(f,{size:"21",depth:3},{default:t(()=>[e(a(u))]),_:1})]),default:t(()=>[v(" 默认赋值给 dataset 字段 ")]),_:1})]),default:t(()=>[e(S,{type:"primary",ghost:"",onClick:U},{icon:t(()=>[e(f,null,{default:t(()=>[e(a(h))]),_:1})]),default:t(()=>[v(" 发送请求 ")]),_:1})]),_:1}),e(a(Oe),{show:w.value&&!m.value,ajax:!0},null,8,["show"]),e(F,{load:m.value,repeat:3},null,8,["load"]),e(a(rt),{modelShow:x.value,"onUpdate:modelShow":s[0]||(s[0]=$=>x.value=$),onSendHandle:U},null,8,["modelShow"])],64)}}});const $t=V(it,[["__scopeId","data-v-8bb854f3"]]);export{$t as default};
