<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
    <title></title>
    <link rel="stylesheet" href="https://cdn.staticfile.org/element-ui/2.15.7/theme-chalk/index.min.css">
    <link rel="stylesheet" href="vFormRender.css?t=20210730"> <!-- 根据Web服务器或CDN路径修改 -->
    <style type="text/css">
    </style>
</head>
<body>

<div id="app">
<!--    <el-button @click="test">测试</el-button>-->
    <v-form-render :form-json="formJson" :form-data="formData" :option-data="optionData" ref="vFormRef">
    </v-form-render>

</div>

<script type="text/javascript">
    if (!!window.ActiveXObject || "ActiveXObject" in window) { //IE load polyfill.js for Promise
        var scriptEle = document.createElement("script");
        scriptEle.type = "text/javascript";
        scriptEle.src = "https://cdn.bootcss.com/babel-polyfill/6.23.0/polyfill.min.js"
        document.body.appendChild(scriptEle)
    }

</script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/vue/2.6.14/vue.min.js"></script>
<script src="https://cdn.staticfile.org/element-ui/2.15.7/index.min.js"></script>
<script th:src="'/business/common/form/vFormRender.umd.min.js?'+${cacheKey}"></script>

<script th:inline="javascript">

    var FORM_JSON = [[${formJson}]];
    var FORM_DATA = [[${formData}]];
    var ID = [[${id}]];
    var ACTION = [[${action}]];
    var vueApp=new Vue({
        el: '#app',
        data: {
            formDataResult:{
                // id:"",
                // data:"",
                // sucess:false,
                // message:""
            },
            formJson: FORM_JSON,
            formData: FORM_DATA,
            optionData: {}
        },
        mounted(){
        },
        methods: {
            updateData:async function(){
                 var res=await  this.updateFormData();
                 console.log("res:",this.formDataResult);
                 return this.formDataResult;
             },
            updateFormData: function(){
                 alert(2)
                 console.log(1111)
                 this.formDataResult.sucess=false;
                 this.formDataResult.id=ID;
                 var _this=this;
                 this.$refs.vFormRef.getFormData().then(function(data){
                     console.log(22222)
                    _this.formDataResult.sucess=true;
                    _this.formDataResult.data=JSON.stringify(data);
                    axios.post('/service-common/sys-form-info/save-form-data',_this.formDataResult).
                        then( function(res) {
                        console.log(333)
                            _this.formDataResult.sucess=true;
                        }).catch(err=>{
                            _this.formDataResult.sucess=true;
                            console.log(err);
                        })
                }).catch( function(error) {
                    // Form Validation Failed
                     console.log(44444)
                    alert(error)
                    _this.formDataResult.sucess=false;
                    _this.formDataResult.message=error;
                })
                 console.log(55555)

            },
            setDissableForm:function(){
              //  this.$refs.vFormRef.disableForm()
            },
            submitForm: function() {

            }
        }
    });

    function updateData(){
        return vueApp.updateData();
    }


    // axios.post('/service-common/sys-form-info/save-form-data',ps).
    // then( function(res) {
    //     var resData=res.data;
    //     if(resData.success){
    //         alert(resData.message);
    //     }else{
    //         alert(resData.message);
    //     }
    // }).catch(err=>{
    //     console.log(err);
    // })
</script>
</body>
</html>

